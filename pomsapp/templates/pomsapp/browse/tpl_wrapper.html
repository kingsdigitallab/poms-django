{% extends "pomsapp/browse/tpl_wrapper_base.html" %}

{% load extrafilters pomsapp_tags %}

{% block permalink %}
    {# <ul class="utl m1"> #}
    {#   <li class="i1"><a href="#" title="Permanent URL for this page, which will allow you to save a bookmark"><b>Permalink: http://tinyurl.com/poms-AE539C3</b></a></li> #}
    {# </ul> #}
{% endblock %}

{# ################## #}
{# #                                   #}
{# #  CONTROL BAR: ACTIVE FACETS LIST  #}
{# #                                   #}
{# ################## #}

{% block controlbar %}
<div class="hds">
    <h3>Selected Terms</h3>
    <ul class="utl m2">
        <li class="i3"><a id="empty_controls" title="Remove all terms"><b>Remove all</b></a></li>
        <li class="i4"><a title="why do I see these results?" onClick="explain_results()"><b>Explain </b></a></li>
        {# <li class="i1"><a href="#" title="Save Terms"><b>Save Terms</b></a></li> #}
        {# <li class="i2"><a href="#" title="Load Terms"><b>Load Terms</b></a></li> #}

    </ul>
</div>

<ul class="nvs active_facets">
    {% for facetgroup, facets in facetgroups_and_facets reversed %}
        <li class="{% cycle 'm0' 'm1' 'm2' 'm3' 'm4' %}">
            <h5 id="{{ facetgroup.uniquename }}" class="no_facets">{{ facetgroup.label|capfirst }}</h5> &#8250;
            {# <a href="#">Facet</a> &#8250;  #}
            {# <strong>FacetValue</strong> <a href="#" class="t9 m2" title="Remove this as a filter">Remove</a> #}
            <small class="no_facets">none</small>
        </li>
    {% endfor %}
</ul>

{# 2010-07-07 hidden fields for BlockUI message #}
<div id="blockUImessage1" style="display:none">
</div>

<div id="blockUImessage2" style="display:none">
</div>
{% endblock %}

{# ################## #}
{# #                                   #}
{# #  RESULTS OF A SEARCH              #}
{# #                                   #}
{# ################## #}

{% block results %}
<!-- hidden fields with useful data -->
{# e.g. a db field to do the ordering on: 'shortdesc', or an annotation command: 'annotate=factoid' #}
<input type="hidden" id="active_ordering" value="default"/>
<input type="hidden" id="refresh_facets" value="{{ count_is_active }}"/>
<!-- end of hidden fields -->

<div class="hds">
    <h3>Matching Records <dfn>(<span id="rec_num">{{ items|length|default:"None"}}</span>)</dfn></h3>
    <ul class="utl m2">
        {# <li class="i1"><a href="#" title="Download these Results"><b>Download these Results</b></a></li> #}
        {% if user.is_superuser %}
            <li class="i1"><a href="javascript:showLogs();" title="Hi there superuser!"><b>Log Query</b></a></li>
            {% if count_test_button %}
                <li class="i1"><a href="javascript:updateFacetValues(true);" title="Hi there superuser!"><b>Update open
                    facet</b></a></li>
            {% endif %}
        {% endif %}
    </ul>
</div>

<div class="tsb">
    <ul class="tsn">

        {% for result_type in result_types %}
            <li id="{{ result_type.uniquename }}"><a
                    href="{% url 'browse' %}{%  add_facet_link querydict 'index_type' result_type.uniquename %}">{{ result_type.label|capfirst }}</a></li>
        {% endfor %}
        {# <li id="factoid"><a href="#results_factoid">Factoids</a></li> #}
        {# <li id="source"><a href="#results_source">Sources</a></li> #}
        {# <li id="people"><a href="#results_people">People</a></li> #}
    </ul>

    <div id="results_factoid" class="tsp">

        {# in order to use the inner block we must move it before the FOR command!!! #}

        {% block inner_results %}
        {% include 'pomsapp/search/snippet_results.html' %}
        {% endblock inner_results %}

    </div>
    <div id="results_source" class="tsp">
        {% include "pomsapp/browse/snippet_noresults.html" %}
    </div>
    <div id="results_people" class="tsp">
        {% include "pomsapp/browse/snippet_noresults.html" %}
    </div>
</div>

{% endblock results %}

{# ################## #}
{# #                                   #}
{# #  FACETS CHOOSER                   #}
{# #                                   #}
{# ################## #}

{% block sidebar %}
<div class="facet-sidebar">
    <h3>Facets available:</h3>
    <form>
        <ul class="facet-group">
            {% for facet_group_names, facet_group_facets in facet_group_fields.items %}
            <li>
                <p>{{ facet_group_names }}</p>
                <ul class="facets-list">
                    {% for facet_name in facet_group_facets %}
                    {% with facets.fields|get_item:facet_name as facet_terms %}
                    <li>
                        <p>
                            <a href="#" class="async" data-facet_group="{{ facet_group_names }}" data-facet_name="{{ facet_name }}" data-index_type="{{ index_type }}">
                                {{ facet_name|capfirst }} ({{ facet_terms|length }})
                            </a>
                        </p>
                        <div class="{{ facet_group_}}__{{ facet_name }}">
                            {# facetvalues are divided into two groups, for display purposes #}

                            {# INNER BLOCK TO BE UPDATED SUBSEQUENTLY #}

                            {% block inner_facet_values %}
                            {% endblock %}
                        </div>
                    </li>
                    {% endwith %}
                    {% endfor %}
                </ul>
            </li>
            {% endfor %}
        </ul>
    </form>
</div>
{% endblock %}

{% comment %}
{% block search %}
<form action="">
    <h3>Facets available:</h3>

    {# start of accordion #}
    <ul id="accordion" class="nvh m1">

        {# we have a list of tuples like this: #}
        {# [(<FacetsGroup1>, [(<Facet1>, [[<FacetValue1>, <FacetValue2>], [<FacetValue3>, <FacetValue4>]]), ('troupe country', [etc..])]), (......)] #}

        {% for facet_group_names, facet_group_facets in facet_group_fields.items %}

            <li class="u {% cycle 'm0' 'm1' 'm2' 'm3' 'm4'  'm5' %}">
                <h4 id="{{ facet_group_names }}"
                    class="to_collapse {{ facet_group_names }}_tip">{{ facet_group_names }}</h4>
                {# the facetgroup #}
                <ul>
                    {% for facet_name in facet_group_facets %}
                        {%  with facets.fields|get_item:facet_name as facet_terms %}
                        <li id="{{ facet.id }}" class="s6">
                            <h5><a href="#" title="Click to collapse facet panel" class="t9 m1 accordion_hook">Collapse</a>

                                <a href="#" class="async" data-facet_group="{{ facet_group_names }}" data-facet_name="{{ facet_name }}" data-index_type="{{ index_type }}">
                                <strong
                                    class="{{ facet_name }}_tip">{{ facet_name|capfirst }} ({{ facet_terms|length }})</strong>
                                </a>
                                {# FILTER BOX: moved it inside the div so that it doesn't interfere with accordion #}
                                {# <fieldset id="fieldset_{{facet.id}}" >   #}
                                {#   <label for="filter_{{facet.0}}">Filter {{facet.0|capfirst|truncatewords:1}}&hellip;</label> #}
                                {#   <input id="filter_{{facet.0}}" /> #}
                                {# </fieldset> #}
                            </h5>
                            <div class="g n2 {{ facet_group_}}__{{ facet_name }}">
                                {# facetvalues are divided into two groups, for display purposes #}

                                {# INNER BLOCK TO BE UPDATED SUBSEQUENTLY #}

                                {% block inner_facet_values %}
                                {% endblock %}
                            </div>
                        </li>
                        {% endwith %}
                    {% endfor %}
                </ul>
            </li>
        {% endfor %}
    </ul>
    {#  end of accordion  #}
</form>
{% endblock %}
{% endcomment %}
